---
import Layout from '../layouts/Layout.astro';

const mailtoLink = `mailto:office@lakeozarkdisciples.org?subject=${encodeURIComponent('Enroll me in the Lake Chimes')}&body=${encodeURIComponent("Hi, I'd like to be added to the Lake Chimes newsletter with this email address! Thanks!")}`;

const newsletters = [
  // 2024
  { date: "April 2024", url: "https://lakeozarkdisciples.org/wp-content/uploads/2024/04/April-2024-Lake-Chimes.pdf" },
  { date: "March 2024", url: "https://lakeozarkdisciples.org/wp-content/uploads/2024/03/March-2024-Lake-Chimes.pdf" },
  { date: "February 2024", url: "https://lakeozarkdisciples.org/wp-content/uploads/2024/02/February-2024-Lake-Chimes.pdf" },
  { date: "January 2024", url: "https://lakeozarkdisciples.org/wp-content/uploads/2024/01/January-2024-Lake-Chimes.pdf" },
  
  // 2023
  { date: "December 2023", url: "https://lakeozarkdisciples.org/wp-content/uploads/2023/12/December-2023-Lake-Chimes.pdf" },
  { date: "November 2023", url: "https://lakeozarkdisciples.org/wp-content/uploads/2023/11/November-2023-Lake-Chimes.pdf" },
  { date: "October 2023", url: "https://lakeozarkdisciples.org/wp-content/uploads/2023/10/October-2023-Lake-Chimes.pdf" },
  { date: "September 2023", url: "https://lakeozarkdisciples.org/wp-content/uploads/2023/09/September-2023-Lake-Chimes.pdf" },
  { date: "August 2023", url: "https://lakeozarkdisciples.org/wp-content/uploads/2023/08/August-2023-Lake-Chimes.pdf" },
  { date: "July 2023", url: "https://lakeozarkdisciples.org/wp-content/uploads/2023/07/July-2023-Lake-Chimes.pdf" },
  { date: "June 2023", url: "https://lakeozarkdisciples.org/wp-content/uploads/2023/06/June-2023-Lake-Chimes.pdf" },
  { date: "May 2023", url: "https://lakeozarkdisciples.org/wp-content/uploads/2023/05/May-2023-Lake-Chimes.pdf" },
  { date: "April 2023", url: "https://lakeozarkdisciples.org/wp-content/uploads/2023/04/April-2023-Lake-Chimes.pdf" },
  { date: "March 2023", url: "https://lakeozarkdisciples.org/wp-content/uploads/2023/03/March-2023-Lake-Chimes.pdf" },
  { date: "February 2023", url: "https://lakeozarkdisciples.org/wp-content/uploads/2023/02/February-2023-Lake-Chimes.pdf" },
  { date: "January 2023", url: "https://lakeozarkdisciples.org/wp-content/uploads/2023/01/January-2023-Lake-Chimes.pdf" },
  
  // 2022
  { date: "December 2022", url: "https://lakeozarkdisciples.org/wp-content/uploads/2022/12/December-2022-Lake-Chimes.pdf" },
  { date: "November 2022", url: "https://lakeozarkdisciples.org/wp-content/uploads/2022/11/November-2022-Lake-Chimes.pdf" },
  { date: "October 2022", url: "https://lakeozarkdisciples.org/wp-content/uploads/2022/10/October-2022-Lake-Chimes.pdf" },
  { date: "September 2022", url: "https://lakeozarkdisciples.org/wp-content/uploads/2022/09/September-2022-Lake-Chimes.pdf" },
  { date: "August 2022", url: "https://lakeozarkdisciples.org/wp-content/uploads/2022/08/August-2022-Lake-Chimes.pdf" },
  { date: "July 2022", url: "https://lakeozarkdisciples.org/wp-content/uploads/2022/07/July-2022-Lake-Chimes.pdf" },
  { date: "June 2022", url: "https://lakeozarkdisciples.org/wp-content/uploads/2022/06/June-2022-Lake-Chimes.pdf" },
  { date: "May 2022", url: "https://lakeozarkdisciples.org/wp-content/uploads/2022/05/May-2022-Lake-Chimes.pdf" },
  { date: "April 2022", url: "https://lakeozarkdisciples.org/wp-content/uploads/2022/04/April-2022-Lake-Chimes.pdf" },
  { date: "March 2022", url: "https://lakeozarkdisciples.org/wp-content/uploads/2022/03/March-2022-Lake-Chimes.pdf" },
  { date: "February 2022", url: "https://lakeozarkdisciples.org/wp-content/uploads/2022/02/February-2022-Lake-Chimes.pdf" },
  { date: "January 2022", url: "https://lakeozarkdisciples.org/wp-content/uploads/2022/01/January-2022-Lake-Chimes.pdf" },
  
  // 2021
  { date: "December 2021", url: "https://lakeozarkdisciples.org/wp-content/uploads/2021/12/December-2021-Lake-Chimes.pdf" },
  { date: "November 2021", url: "https://lakeozarkdisciples.org/wp-content/uploads/2021/11/November-2021-Lake-Chimes.pdf" },
  { date: "October 2021", url: "https://lakeozarkdisciples.org/wp-content/uploads/2021/10/October-2021-Lake-Chimes.pdf" },
  { date: "September 2021", url: "https://lakeozarkdisciples.org/wp-content/uploads/2021/09/September-2021-Lake-Chimes.pdf" }
];

const latestNewsletter = newsletters[0];
const olderNewsletters = newsletters.slice(1);

// Group newsletters by year
const groupedNewsletters = olderNewsletters.reduce((acc, newsletter) => {
  const year = newsletter.date.split(' ')[1];
  if (!acc[year]) {
    acc[year] = [];
  }
  acc[year].push(newsletter);
  return acc;
}, {} as Record<string, typeof newsletters>);

const years = Object.keys(groupedNewsletters).sort((a, b) => Number(b) - Number(a));
---

<Layout title="Lake Chimes Newsletter">
  <div class="container mx-auto px-4 py-16">
    <div class="max-w-4xl mx-auto">
      <h1 class="text-5xl font-bold mb-12 text-center">Lake Chimes Newsletter</h1>
      
      <div class="space-y-12">
        <!-- Introduction -->
        <div class="bg-white p-8 rounded-2xl shadow-lg">
          <h2 class="text-3xl font-bold mb-6">Stay Connected</h2>
          <p class="text-xl text-gray-600">
            Lake Chimes is our monthly newsletter, keeping our community informed about upcoming events, 
            important announcements, and inspiring stories from our congregation.
          </p>
        </div>

        <!-- Latest Newsletter -->
        <div class="bg-white p-8 rounded-2xl shadow-lg">
          <h2 class="text-2xl font-bold mb-6">Latest Issue</h2>
          <a 
            href={latestNewsletter.url}
            target="_blank"
            class="block bg-gray-50 p-6 rounded-xl hover:bg-gray-100 transition"
          >
            <div class="flex items-center justify-between">
              <div>
                <h3 class="text-xl font-bold">{latestNewsletter.date} Newsletter</h3>
                <p class="text-gray-600">Click to download PDF</p>
              </div>
              <svg class="w-6 h-6 text-brand" fill="currentColor" viewBox="0 0 20 20">
                <path d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v3.586L7.707 9.293a1 1 0 00-1.414 1.414l3 3a1 1 0 001.414 0l3-3a1 1 0 00-1.414-1.414L11 10.586V7z"/>
              </svg>
            </div>
          </a>
        </div>

        <!-- Archive -->
        <div class="bg-white p-8 rounded-2xl shadow-lg">
          <h2 class="text-2xl font-bold mb-6">Newsletter Archive</h2>
          <div class="space-y-4">
            {years.map(year => (
              <details class="group">
                <summary class="flex items-center justify-between cursor-pointer bg-gray-50 p-4 rounded-xl hover:bg-gray-100 transition">
                  <span class="font-semibold">{year} Issues</span>
                  <svg 
                    class="w-5 h-5 transition group-open:rotate-180" 
                    fill="none" 
                    stroke="currentColor" 
                    viewBox="0 0 24 24"
                  >
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                  </svg>
                </summary>
                <div class="mt-4 space-y-2 pl-4">
                  {groupedNewsletters[year].map(newsletter => (
                    <a 
                      href={newsletter.url}
                      target="_blank"
                      class="block p-4 hover:bg-gray-50 rounded-lg transition"
                    >
                      <div class="flex items-center justify-between">
                        <span>{newsletter.date}</span>
                        <svg class="w-5 h-5 text-brand" fill="currentColor" viewBox="0 0 20 20">
                          <path d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v3.586L7.707 9.293a1 1 0 00-1.414 1.414l3 3a1 1 0 001.414 0l3-3a1 1 0 00-1.414-1.414L11 10.586V7z"/>
                        </svg>
                      </div>
                    </a>
                  ))}
                </div>
              </details>
            ))}
          </div>
        </div>

        <!-- Subscribe Section -->
        <div class="bg-white p-8 rounded-2xl shadow-lg">
          <h2 class="text-2xl font-bold mb-6">Get Lake Chimes in Your Inbox</h2>
          <p class="text-gray-600 mb-6">
            Want to receive Lake Chimes directly in your email? Click below to send us a request and we'll add you to our mailing list.
          </p>
          <a 
            href={mailtoLink}
            class="inline-flex items-center gap-2 bg-brand text-white px-6 py-3 rounded-full hover:bg-brand-dark transition"
          >
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
              <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"/>
              <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"/>
            </svg>
            Subscribe to Newsletter
          </a>
        </div>
      </div>
    </div>
  </div>
</Layout>