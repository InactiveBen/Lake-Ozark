---
import Layout from '../layouts/Layout.astro';
import YouTubePopup from '../components/YouTubePopup.astro';

// Toggle this to show/hide the announcement banner
const showAnnouncementBanner = true;

// Banner content - edit these to change the announcement
const bannerText = "Get registered for the After-School Program!";
const bannerLink = "https://docs.google.com/forms/d/e/1FAIpQLSdIri3EaabwsN84Al7Xd7zVnWI7Jzfaoyu6NVkENI6w9FRaeA/viewform?usp=sf_link";
const bannerLinkText = "Sign up today â†’";

const welcomeImage = {
  url: "https://cdn-locc-org.vercel.app/media/7767E813-185B-48B7-A7C8-A5C919258FEA.jpeg",
  alt: "Church Sanctuary"
};

// Get recent blog posts for featured section
const posts = await Astro.glob('../blogs/*.md');
const recentPosts = posts
  .filter(post => post.frontmatter && post.frontmatter.id)
  .sort((a, b) => (b.frontmatter?.id || 0) - (a.frontmatter?.id || 0))
  .slice(0, 3);

function formatDate(dateStr: string): string {
  try {
    return new Date(dateStr).toLocaleDateString('en-US', {
      year: 'numeric',
      month: 'long',
      day: 'numeric',
    });
  } catch {
    return 'Date unavailable';
  }
}

---

<Layout title="Welcome">
<!-- Hero Section - Clean and Minimalist -->
<section class="relative overflow-hidden bg-white">
  <div class="absolute inset-0">
    <img 
      src={welcomeImage.url} 
      alt={welcomeImage.alt}
      class="w-full h-full object-cover"
    />
    <div class="absolute inset-0 bg-black/40"></div>
  </div>

  <div class="relative container mx-auto px-6 py-32 md:py-40">
    {showAnnouncementBanner && (
    <!-- Announcement Banner - Overlaid on Hero -->
    <div class="mb-8">
      <div class="inline-flex items-center gap-3 bg-white/10 backdrop-blur-sm px-6 py-3 rounded-full border border-white/20">
        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5.882V19.24a1.76 1.76 0 01-3.417.592l-2.147-6.15M18 13a3 3 0 100-6M5.436 13.683A4.001 4.001 0 017 6h1.832c4.1 0 7.625-1.234 9.168-3v14c-1.543-1.766-5.067-3-9.168-3H7a3.988 3.988 0 01-1.564-.317z" />
        </svg>
        <p class="text-white font-medium text-sm">
          <strong>New:</strong> {bannerText}
          <a href={bannerLink} 
             target="_blank" 
             rel="noopener noreferrer"
             class="underline hover:no-underline ml-2">
            {bannerLinkText}
          </a>
        </p>
      </div>
    </div>
    )}

    <div class="max-w-4xl">
      <p class="text-xl md:text-2xl text-white/90 mb-4 font-light leading-relaxed">
        There's a place for you here.
      </p>
      <h1 class="text-5xl md:text-7xl font-semibold text-white mb-8 leading-tight tracking-tight">
        Lake Ozark Christian
      </h1>
      <p class="text-lg md:text-xl text-white/80 mb-12 max-w-2xl font-light leading-relaxed">
        A community of faith dedicated to sharing the Gospel of Jesus Christ. All are welcome.
      </p>
      
      <div class="flex flex-col sm:flex-row gap-4">
        <a 
          href="/worship" 
          class="inline-flex items-center justify-center px-8 py-4 bg-brand hover:bg-brand-dark text-white font-medium rounded-lg transition-all duration-300 text-lg"
        >
          Plan Your Visit
        </a>
        <a 
          href="https://www.youtube.com/channel/UCUcLKfZo5Su6-ypmt1dkPKA" 
          target="_blank"
          rel="noopener noreferrer"
          class="inline-flex items-center justify-center px-8 py-4 bg-transparent border-2 border-white text-white hover:bg-white hover:text-gray-900 font-medium rounded-lg transition-all duration-300 text-lg"
        >
          Watch Online
        </a>
      </div>
    </div>
  </div>
</section>

<!-- Service Information - Clean Cards -->
<section id="visit" class="py-20 bg-white">
  <div class="container mx-auto px-6">
    <div class="max-w-7xl mx-auto">
      <div class="text-center mb-16">
        <span class="inline-block px-4 py-2 bg-brand/10 text-brand text-sm font-medium mb-4">
          Visit Us
        </span>
        <h2 class="text-4xl lg:text-5xl font-light mb-6 text-gray-900">Service Times & Location</h2>
        <p class="text-lg text-gray-600 max-w-2xl mx-auto">
          Join us for worship, fellowship, and community programs throughout the week
        </p>
      </div>
      
      <div class="grid sm:grid-cols-3 gap-8 max-w-6xl mx-auto">
      <div class="text-center p-8">
        <div class="w-16 h-16 bg-brand/10 rounded-full flex items-center justify-center mx-auto mb-6">
          <svg class="w-8 h-8 text-brand" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
        </div>
        <h2 class="text-2xl font-semibold mb-2 text-gray-900">Sunday Service</h2>
        <p class="text-lg font-light text-gray-700">Sun 8:30 AM & 10:30 AM</p>
      </div>
      
      <div class="text-center p-8">
        <div class="w-16 h-16 bg-brand/10 rounded-full flex items-center justify-center mx-auto mb-6">
          <svg class="w-8 h-8 text-brand" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
          </svg>
        </div>
        <h2 class="text-2xl font-semibold mb-2 text-gray-900">Location</h2>
        <p class="text-lg font-light text-gray-700">1560 Bagnell Dam Blvd.</p>
      </div>
      
      <div class="text-center p-8">
        <div class="w-16 h-16 bg-brand/10 rounded-full flex items-center justify-center mx-auto mb-6">
          <svg class="w-8 h-8 text-brand" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
          </svg>
        </div>
        <h2 class="text-2xl font-semibold mb-2 text-gray-900">After-School Program</h2>
        <p class="text-lg font-light text-gray-700">Wed 3:30-5:30 PM</p>
      </div>
      </div>
    </div>
  </div>
</section>

<!-- Live Service Countdown -->
<section id="live-service" class="py-20 bg-white">
  <div class="container mx-auto px-6">
    <div class="max-w-4xl mx-auto text-center">
      <div id="countdown-container" class="hidden">
        <span class="inline-block px-4 py-2 bg-brand/10 text-brand text-sm font-medium mb-4">
          Next Live Service
        </span>
        <h2 id="service-title" class="text-2xl lg:text-3xl font-light mb-6 text-gray-900">
          Loading...
        </h2>
        <div class="grid grid-cols-4 gap-4 mb-8 max-w-2xl mx-auto">
          <div class="bg-white rounded-xl p-4 shadow-sm">
            <div id="days" class="text-3xl font-bold text-brand">00</div>
            <div class="text-sm text-gray-600">Days</div>
          </div>
          <div class="bg-white rounded-xl p-4 shadow-sm">
            <div id="hours" class="text-3xl font-bold text-brand">00</div>
            <div class="text-sm text-gray-600">Hours</div>
          </div>
          <div class="bg-white rounded-xl p-4 shadow-sm">
            <div id="minutes" class="text-3xl font-bold text-brand">00</div>
            <div class="text-sm text-gray-600">Minutes</div>
          </div>
          <div class="bg-white rounded-xl p-4 shadow-sm">
            <div id="seconds" class="text-3xl font-bold text-brand">00</div>
            <div class="text-sm text-gray-600">Seconds</div>
          </div>
        </div>
        <a 
          id="live-stream-btn"
          href="https://live.locc.us" 
          target="_blank"
          rel="noopener noreferrer"
          class="hidden inline-flex items-center justify-center px-8 py-4 bg-brand hover:bg-brand-dark text-white font-medium rounded-lg transition-all duration-300 text-lg"
        >
          Join Live Stream
        </a>
      </div>
      
      <div id="countdown-loading" class="py-8">
        <div class="inline-flex items-center gap-3">
          <div class="animate-spin rounded-full h-8 w-8 border-2 border-brand border-t-transparent"></div>
          <p class="text-lg text-gray-600">Loading next service...</p>
        </div>
      </div>
      
      <div id="countdown-error" class="hidden py-8">
        <p class="text-gray-600">Unable to load service information</p>
      </div>
    </div>
  </div>
</section>

<!-- After School Program -->
<section id="after-school" class="py-20 bg-white">
  <div class="container mx-auto px-6">
    <div class="max-w-7xl mx-auto">
      <div class="grid lg:grid-cols-2 gap-16 items-center">
        <div>
          <span class="inline-block px-4 py-2 bg-brand/10 text-brand text-sm font-medium mb-6">
            Community Program
          </span>
          <h2 class="text-4xl lg:text-5xl font-light mb-8 text-gray-900 leading-tight">
            After-School Program
          </h2>
          <div class="space-y-6">
            <p class="text-lg text-gray-600 leading-relaxed">
              Give your child a safe, engaging space to grow after school! Our program combines fun activities, homework help, and meaningful connections - all in a nurturing environment.
            </p>
            <div class="bg-gray-50 rounded-xl p-6 space-y-4">
              <div class="flex items-start gap-3">
                <svg class="w-6 h-6 text-brand mt-1 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <div>
                  <h3 class="font-medium text-gray-900">Perfect for Busy Parents</h3>
                  <p class="text-gray-600">Wednesdays 3:30-5:30 PM, giving you time to handle errands or work commitments</p>
                </div>
              </div>
              <div class="flex items-start gap-3">
                <svg class="w-6 h-6 text-brand mt-1 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
                </svg>
                <div>
                  <h3 class="font-medium text-gray-900">Safe & Supervised</h3>
                  <p class="text-gray-600 group relative">
                    Qualified staff and volunteers ensure a secure, caring environment
                    <span class="tooltip invisible group-hover:visible absolute left-0 bottom-full mb-2 w-64 p-2 bg-gray-900 text-white text-sm rounded-lg shadow-lg">
                      For your child's safety, every staff member and volunteer must pass comprehensive background checks. 
                    </span>
                  </p>
                </div>
              </div>
            </div>
            <div class="flex flex-col sm:flex-row gap-4">
              <a 
                href="https://docs.google.com/forms/d/e/1FAIpQLSdIri3EaabwsN84Al7Xd7zVnWI7Jzfaoyu6NVkENI6w9FRaeA/viewform?usp=sf_link"
                target="_blank"
                rel="noopener noreferrer" 
                class="inline-flex items-center justify-center px-8 py-4 bg-brand hover:bg-brand-dark text-white font-medium rounded-lg transition-all duration-300"
              >
                Reserve Your Spot
              </a>
              <a 
                href="/children-youth" 
                class="inline-flex items-center justify-center px-8 py-4 bg-gray-900 hover:bg-gray-800 text-white font-medium rounded-lg transition-all duration-300"
              >
                Learn More
              </a>
            </div>
          </div>
        </div>
        <div class="relative hidden lg:block">
          <img 
            src="https://cdn-locc-org.vercel.app/media/8F240771-48E1-4868-9BC6-6AB8256F433F.jpeg"
            alt="Children participating in after-school activities"
            class="w-full h-[600px] object-cover rounded-2xl"
          />
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Featured Blog Posts -->
{recentPosts.length > 0 && (
<section id="blog" class="py-20 bg-white">
  <div class="container mx-auto px-6">
    <div class="max-w-7xl mx-auto">
      <div class="text-center mb-16">
        <span class="inline-block px-4 py-2 bg-brand/10 text-brand text-sm font-medium mb-4">
          Latest Updates
        </span>
        <h2 class="text-4xl lg:text-5xl font-light mb-6 text-gray-900">From Our Community</h2>
        <p class="text-lg text-gray-600 max-w-2xl mx-auto">
          Stay connected with the latest news, events, and stories from our church family
        </p>
      </div>
      
      <div class="grid md:grid-cols-3 gap-8">
        {recentPosts.map((post, index) => (
          <article class="group">
            <a href={`/blog/${post.frontmatter?.id || ''}`} class="block">
              <div class="mb-6 overflow-hidden rounded-xl">
                <img 
                  src={post.frontmatter?.image || 'https://cdn-locc-org.vercel.app/media/8F240771-48E1-4868-9BC6-6AB8256F433F.jpeg'} 
                  alt={post.frontmatter?.title || 'Blog post'}
                  class="w-full h-64 object-cover group-hover:scale-105 transition-transform duration-500"
                />
              </div>
              <div>
                <time class="text-sm text-gray-500 mb-2 block">
                  {formatDate(post.frontmatter?.date || '')}
                </time>
                <h3 class="text-xl font-semibold mb-3 text-gray-900 group-hover:text-brand transition-colors duration-300">
                  {post.frontmatter?.title || 'Untitled'}
                </h3>
                <p class="text-gray-600 leading-relaxed">
                  {post.frontmatter?.excerpt || ''}
                </p>
              </div>
            </a>
          </article>
        ))}
      </div>
      
      <div class="text-center mt-12">
        <a 
          href="/blog" 
          class="inline-flex items-center justify-center px-8 py-4 bg-gray-900 hover:bg-gray-800 text-white font-medium rounded-lg transition-all duration-300"
        >
          View All Posts
        </a>
      </div>
    </div>
  </div>
</section>
)}

<!-- Recent Services -->
<section id="services" class="py-20 bg-white">
  <div class="container mx-auto px-6">
    <div class="max-w-7xl mx-auto">
      <div class="text-center mb-16">
        <span class="inline-block px-4 py-2 bg-brand/10 text-brand text-sm font-medium mb-4">
          Watch & Listen
        </span>
        <h2 class="text-4xl lg:text-5xl font-light mb-6 text-gray-900">Recent Services</h2>
        <p class="text-lg text-gray-600 max-w-2xl mx-auto">
          Catch up on our latest worship services and messages
        </p>
      </div>
      
      <div id="video-loading" class="text-center py-16">
        <div class="inline-flex items-center gap-3">
          <div class="animate-spin rounded-full h-8 w-8 border-2 border-brand border-t-transparent"></div>
          <p class="text-lg text-gray-600">Loading recent services...</p>
        </div>
      </div>
      
      <div id="video-error" class="text-center py-16 hidden">
        <div class="bg-red-50 border border-red-200 p-8 max-w-md mx-auto">
          <p class="text-red-700 font-medium">Failed to load recent services</p>
          <p class="text-red-600 text-sm mt-1">Please try again later</p>
        </div>
      </div>
      
      <div id="video-container"></div>
    </div>
  </div>
</section>

<!-- Support Our Ministry Section -->
<section id="donate" class="py-20 bg-white">
  <div class="container mx-auto px-6">
    <div class="max-w-7xl mx-auto">
      <div class="grid lg:grid-cols-2 gap-16 items-center">
        <div>
          <span class="inline-block px-4 py-2 bg-brand/10 text-brand text-sm font-medium mb-6">
            Support Our Ministry
          </span>
          <h2 class="text-4xl lg:text-5xl font-light mb-8 text-gray-900 leading-tight">
            Help Us Share God's Love
          </h2>
          <p class="text-lg text-gray-600 mb-8 leading-relaxed">
            Your generous donations help support our worship services, community programs, and outreach efforts. 
            Every gift makes a difference in our mission to serve others.
          </p>
          <div class="flex flex-col sm:flex-row gap-4">
            <a 
              href="/giving" 
              class="inline-flex items-center justify-center px-8 py-4 bg-brand hover:bg-brand-dark text-white font-medium rounded-lg transition-all duration-300"
            >
              More Giving Options
            </a>
            <a 
              href="tel:573-365-3366" 
              class="inline-flex items-center justify-center px-8 py-4 bg-gray-900 hover:bg-gray-800 text-white font-medium rounded-lg transition-all duration-300"
            >
              Contact Us
            </a>
          </div>
        </div>
        <div class="relative">
          <div class="bg-gray-50 rounded-2xl p-8">
            <form id="homepage-donation-form" class="space-y-6">
              <!-- Donation Type -->
              <div>
                <div class="grid grid-cols-2 gap-4 mb-4">
                  <label class="relative">
                    <input 
                      type="radio" 
                      name="donationType" 
                      value="one-time" 
                      checked 
                      class="peer sr-only"
                    />
                    <div class="p-3 border-2 border-gray-200 rounded-lg cursor-pointer peer-checked:border-brand peer-checked:bg-brand/5 transition-all duration-300 bg-white">
                      <div class="text-center">
                        <div class="font-medium text-gray-900">One-time</div>
                        <div class="text-sm text-gray-600">Single donation</div>
                      </div>
                    </div>
                  </label>
                  <label class="relative">
                    <input 
                      type="radio" 
                      name="donationType" 
                      value="recurring" 
                      class="peer sr-only"
                    />
                    <div class="p-3 border-2 border-gray-200 rounded-lg cursor-pointer peer-checked:border-brand peer-checked:bg-brand/5 transition-all duration-300 bg-white">
                      <div class="text-center">
                        <div class="font-medium text-gray-900">Recurring</div>
                        <div class="text-sm text-gray-600">Ongoing giving</div>
                      </div>
                    </div>
                  </label>
                </div>
                
                <!-- Recurring Frequency Selection -->
                <div id="homepage-frequency-selection" class="hidden">
                  <label class="block text-sm font-medium text-gray-700 mb-2">Frequency</label>
                  <select 
                    name="frequency" 
                    id="homepage-frequency-select"
                    class="w-full px-3 py-3 border-2 border-gray-200 rounded-lg focus:border-brand focus:outline-none bg-white"
                  >
                    <option value="weekly">Weekly</option>
                    <option value="biweekly">Every Two Weeks</option>
                    <option value="monthly" selected>Monthly</option>
                    <option value="every6months">Every Six Months</option>
                    <option value="yearly">Every Year</option>
                  </select>
                </div>
              </div>

              <!-- Amount Selection -->
              <div>
                <div class="grid grid-cols-3 gap-3 mb-4">
                  <button type="button" class="homepage-amount-btn p-3 border-2 border-gray-200 rounded-lg hover:border-brand transition-all duration-300 bg-white" data-amount="25">
                    <div class="font-medium">$25</div>
                  </button>
                  <button type="button" class="homepage-amount-btn p-3 border-2 border-gray-200 rounded-lg hover:border-brand transition-all duration-300 bg-white" data-amount="50">
                    <div class="font-medium">$50</div>
                  </button>
                  <button type="button" class="homepage-amount-btn p-3 border-2 border-gray-200 rounded-lg hover:border-brand transition-all duration-300 bg-white" data-amount="100">
                    <div class="font-medium">$100</div>
                  </button>
                </div>
                <div class="relative">
                  <span class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500">$</span>
                  <input 
                    type="number" 
                    id="homepage-custom-amount" 
                    name="amount"
                    min="5" 
                    max="999999"
                    step="0.01"
                    placeholder="Enter custom amount"
                    class="w-full pl-7 pr-3 py-3 border-2 border-gray-200 rounded-lg focus:border-brand focus:outline-none bg-white"
                  />
                </div>
              </div>

              <!-- Email -->
              <div>
                <input 
                  type="email" 
                  id="homepage-email" 
                  name="email"
                  required
                  placeholder="your@email.com"
                  class="w-full px-3 py-3 border-2 border-gray-200 rounded-lg focus:border-brand focus:outline-none bg-white"
                />
              </div>

              <!-- Submit Button -->
              <div>
                <button 
                  type="submit"
                  id="homepage-donate-btn"
                  class="w-full bg-brand hover:bg-brand-dark text-white font-medium py-3 px-6 rounded-lg transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed"
                >
                  <span id="homepage-btn-text">Give Now</span>
                  <span id="homepage-btn-loading" class="hidden">Processing...</span>
                </button>
              </div>

              <!-- Recurring Donation Warning -->
              <div id="homepage-recurring-warning" class="text-center text-xs text-gray-600 bg-gray-50 rounded-lg p-3 hidden">
                <p class="text-gray-700">You will be charged <span id="homepage-warning-amount" class="font-medium">$50</span> <span id="homepage-warning-frequency" class="font-medium">monthly</span> starting <span id="homepage-warning-date" class="font-medium"></span>. Cancel anytime.</p>
              </div>

              <!-- Security Note -->
              <div class="text-center text-xs text-gray-600 space-y-2">
                <p>Secure donation processed through Stripe. Tax-deductible receipt sent to your email.</p>
                <p>
                  <a 
                    href="https://billing.stripe.com/p/login/14k15102u3dA1H2144" 
                    target="_blank" 
                    rel="noopener noreferrer"
                    class="text-brand hover:text-brand-dark underline"
                  >
                    Manage existing subscription â†’
                  </a>
                </p>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Find Us Section -->
<section id="location" class="py-20 bg-white">
  <div class="container mx-auto px-6">
    <div class="max-w-7xl mx-auto">
      <div class="grid lg:grid-cols-2 gap-16 items-center">
        <div class="relative">
          <div class="bg-gray-50 rounded-2xl p-8">
            <div class="w-full rounded-xl overflow-hidden" style="position: relative; padding-bottom: 75%;">
              <iframe 
                src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d387.9011776781!2d-92.6386717!3d38.1981839!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x87c4c5de89ac8075%3A0xd6b3ef02b5ac85cf!2sLake%20Ozark%20Christian%20Church!5e0!3m2!1sen!2sus!4v1730580207869!5m2!1sen!2sus"
                style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: 0;"
                allowfullscreen=""
                loading="lazy"
                title="Lake Ozark Christian Church Location"
                aria-label="Google Maps showing Lake Ozark Christian Church location at 1560 Bagnell Dam Blvd, Lake Ozark, MO"
              ></iframe>
            </div>
          </div>
        </div>
        <div>
          <span class="inline-block px-4 py-2 bg-brand/10 text-brand text-sm font-medium mb-6">
            Visit Us
          </span>
          <h2 class="text-4xl lg:text-5xl font-light mb-8 text-gray-900 leading-tight">
            Find Us
          </h2>
          <p class="text-lg text-gray-600 mb-8 leading-relaxed">
            Located in the heart of Lake Ozark, we're easy to find and always welcoming. 
            Join us for worship, fellowship, and community events.
          </p>
          <div class="space-y-6">
            <div class="bg-gray-50 rounded-xl p-6">
              <h3 class="font-medium text-gray-900 mb-3">Our Address</h3>
              <address class="not-italic text-gray-600 leading-relaxed">
                1560 Bagnell Dam Blvd <br>
                Lake Ozark, MO 65049
              </address>
            </div>
            <div class="flex flex-col sm:flex-row gap-4">
              <a 
                href="tel:573-365-3366" 
                class="inline-flex items-center justify-center px-8 py-4 bg-brand hover:bg-brand-dark text-white font-medium rounded-lg transition-all duration-300"
              >
                Call Us: 573-365-3366
              </a>
              <a 
                href="/connect" 
                class="inline-flex items-center justify-center px-8 py-4 bg-gray-900 hover:bg-gray-800 text-white font-medium rounded-lg transition-all duration-300"
              >
                Get Directions
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Calendar Section -->
<section id="calendar" class="py-20 bg-white">
  <div class="container mx-auto px-6">
    <div class="max-w-7xl mx-auto">
      <div class="text-center mb-16">
        <span class="inline-block px-4 py-2 bg-brand/10 text-brand text-sm font-medium mb-4">
          Stay Connected
        </span>
        <h2 class="text-4xl lg:text-5xl font-light mb-6 text-gray-900">Upcoming Events</h2>
        <p class="text-lg text-gray-600 max-w-2xl mx-auto">
          Join us for worship, fellowship, and community events
        </p>
      </div>
      
              <div class="bg-white border border-gray-200 overflow-hidden rounded-2xl">
          <div class="p-8">
            <div class="w-full rounded-xl overflow-hidden" style="position: relative; padding-bottom: 75%;">
              <iframe 
                src="https://calendar.google.com/calendar/embed?src=lakeozarkdisciples%40gmail.com&ctz=America%2FChicago" 
                style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: 0;"
                title="Lake Ozark Christian Church Calendar"
                aria-label="Google Calendar showing upcoming church events"
              ></iframe>
            </div>
          </div>
        </div>
    </div>
  </div>
</section>

<YouTubePopup />

<script>
  // Live Service Countdown functionality
  let countdownInterval;
  let nextServiceTime = null;
  
  async function fetchNextService() {
    const loadingEl = document.getElementById('countdown-loading');
    const errorEl = document.getElementById('countdown-error');
    const containerEl = document.getElementById('countdown-container');
    
    try {
      const response = await fetch('https://live.locc.us/graphql', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          query: `
            query {
              currentOrganization {
                servicesConnection {
                  services {
                    scheduleTime
                    content {
                      title
                    }
                  }
                }
              }
            }
          `
        })
      });
      
      if (!response.ok) throw new Error('Failed to fetch service data');
      
      const data = await response.json();
      const services = data.data?.currentOrganization?.servicesConnection?.services || [];
      
      // Find the next upcoming service
      const now = new Date();
             const upcomingServices = services
         .filter(service => service.scheduleTime && new Date(service.scheduleTime) > now)
         .sort((a, b) => new Date(a.scheduleTime).getTime() - new Date(b.scheduleTime).getTime());
      
      if (upcomingServices.length > 0) {
        const nextService = upcomingServices[0];
        nextServiceTime = new Date(nextService.scheduleTime);
        
                 // Update service title
         const titleEl = document.getElementById('service-title');
         if (titleEl && nextService.content?.title) {
           titleEl.textContent = nextService.content.title;
         } else if (titleEl) {
           titleEl.textContent = 'Worship with Rev. Ron Trimmer';
         }
        
        // Show countdown and start timer
        if (loadingEl) loadingEl.style.display = 'none';
        if (containerEl) containerEl.classList.remove('hidden');
        
        startCountdown();
        
      } else {
        // No upcoming services
        if (loadingEl) loadingEl.style.display = 'none';
        if (errorEl) {
          errorEl.classList.remove('hidden');
          errorEl.querySelector('p').textContent = 'No upcoming services scheduled';
        }
      }
      
    } catch (error) {
      console.error('Error fetching service data:', error);
      if (loadingEl) loadingEl.style.display = 'none';
      if (errorEl) errorEl.classList.remove('hidden');
    }
  }
  
  function startCountdown() {
    if (!nextServiceTime) return;
    
    countdownInterval = setInterval(() => {
      const now = new Date().getTime();
      const distance = nextServiceTime.getTime() - now;
      
      if (distance < 0) {
        // Service has started or passed
        clearInterval(countdownInterval);
        
        // Hide countdown and show "Live Now" or fetch next service
        const containerEl = document.getElementById('countdown-container');
        if (containerEl) {
          containerEl.innerHTML = `
            <span class="inline-block px-4 py-2 bg-red-100 text-red-600 text-sm font-medium mb-4">
              Live Now
            </span>
            <h2 class="text-2xl lg:text-3xl font-light mb-6 text-gray-900">
              Service is Live!
            </h2>
            <a 
              href="https://live.locc.us" 
              target="_blank"
              rel="noopener noreferrer"
              class="inline-flex items-center justify-center px-8 py-4 bg-red-600 hover:bg-red-700 text-white font-medium rounded-lg transition-all duration-300 text-lg animate-pulse"
            >
              Join Live Stream Now
            </a>
          `;
        }
        
        return;
      }
      
      // Calculate time units
      const days = Math.floor(distance / (1000 * 60 * 60 * 24));
      const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
      const seconds = Math.floor((distance % (1000 * 60)) / 1000);
      
      // Update countdown display
      const daysEl = document.getElementById('days');
      const hoursEl = document.getElementById('hours');
      const minutesEl = document.getElementById('minutes');
      const secondsEl = document.getElementById('seconds');
      const liveStreamBtn = document.getElementById('live-stream-btn');
      
      if (daysEl) daysEl.textContent = days.toString().padStart(2, '0');
      if (hoursEl) hoursEl.textContent = hours.toString().padStart(2, '0');
      if (minutesEl) minutesEl.textContent = minutes.toString().padStart(2, '0');
      if (secondsEl) secondsEl.textContent = seconds.toString().padStart(2, '0');
      
      // Show/hide live stream button based on time remaining
      // Show button only if less than 5 hours remain (5 * 60 * 60 * 1000 = 18,000,000 ms)
      if (liveStreamBtn) {
        if (distance < 18000000) { // Less than 5 hours
          liveStreamBtn.classList.remove('hidden');
        } else {
          liveStreamBtn.classList.add('hidden');
        }
      }
      
    }, 1000);
  }
  
  // Initialize countdown
  fetchNextService();
  
  // Re-fetch service data every 30 minutes
  setInterval(fetchNextService, 30 * 60 * 1000);
  
  let currentVideoPage = 0;
  let allVideos: any[] = [];
  const videosPerPage = 3;

  async function loadVideos() {
    const loadingEl = document.getElementById('video-loading');
    const errorEl = document.getElementById('video-error');
    const containerEl = document.getElementById('video-container');
    
    try {
      const response = await fetch('/api/videos.json');
      if (!response.ok) throw new Error('Failed to fetch videos');
      
      allVideos = await response.json();
      
      if (loadingEl) loadingEl.style.display = 'none';
      
      displayVideos();
      
    } catch (error) {
      console.error('Error loading videos:', error);
      if (loadingEl) loadingEl.style.display = 'none';
      if (errorEl) errorEl.style.display = 'block';
    }
  }

  function displayVideos() {
    const containerEl = document.getElementById('video-container');
    if (!containerEl || allVideos.length === 0) return;

    const startIndex = 0;
    const endIndex = Math.min(videosPerPage * (currentVideoPage + 1), allVideos.length);
    const videosToShow = allVideos.slice(startIndex, endIndex);
    
    const videoGridHTML = `
      <div class="space-y-12">
        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8" id="video-grid">
                     ${videosToShow.map((video) => `
             <div class="video-item bg-white border border-gray-200 overflow-hidden group hover:shadow-lg transition-all duration-300 rounded-xl">
               <a 
                 href="https://www.youtube.com/watch?v=${video.id}"
                 target="_blank"
                 rel="noopener noreferrer"
                 class="block"
                 aria-label="Watch ${video.title} on YouTube (opens in new tab)"
               >
                 <div class="relative aspect-video overflow-hidden">
                   <img 
                     src="${video.customThumbnail || `https://img.youtube.com/vi/${video.id}/maxresdefault.jpg`}"
                     alt="Thumbnail for ${video.title}"
                     class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"
                   />
                   <div class="absolute inset-0 bg-black/0 group-hover:bg-black/30 transition-all duration-300 flex items-center justify-center">
                     <div class="opacity-0 group-hover:opacity-100 transition-opacity duration-300 bg-white/20 backdrop-blur-sm rounded-full p-4">
                       <svg class="w-12 h-12 text-white" fill="currentColor" viewBox="0 0 24 24">
                         <path d="M8 5v14l11-7z"/>
                       </svg>
                     </div>
                   </div>
                 </div>
                 <div class="p-6">
                   <h3 class="font-semibold text-lg text-gray-900 group-hover:text-brand transition-colors duration-300 leading-tight">${video.title}</h3>
                 </div>
               </a>
             </div>
           `).join('')}
        </div>
        ${endIndex < allVideos.length ? `
          <div class="text-center">
            <button
              id="view-more-btn"
              class="inline-flex items-center justify-center px-8 py-4 bg-brand hover:bg-brand-dark text-white font-medium rounded-lg transition-all duration-300"
            >
              View More Services
            </button>
          </div>
        ` : ''}
      </div>
    `;
    
    containerEl.innerHTML = videoGridHTML;
    setupVideoGrid();
  }

  function setupVideoGrid() {
    const viewMoreBtn = document.getElementById('view-more-btn');
    
    if (viewMoreBtn) {
      viewMoreBtn.addEventListener('click', () => {
        currentVideoPage++;
        displayVideos();
      });
    }
  }

  loadVideos();
  document.addEventListener('astro:page-load', () => {
    currentVideoPage = 0;
    allVideos = [];
    loadVideos();
  });

  // Homepage donation form functionality
  // Function to update recurring warning
  function updateHomepageRecurringWarning() {
    const recurringRadio = document.querySelector('input[name="donationType"][value="recurring"]') as HTMLInputElement;
    const warningDiv = document.getElementById('homepage-recurring-warning');
    const warningAmount = document.getElementById('homepage-warning-amount');
    const warningFrequency = document.getElementById('homepage-warning-frequency');
    const warningDate = document.getElementById('homepage-warning-date');
    const amountInput = document.getElementById('homepage-custom-amount') as HTMLInputElement;
    const frequencySelect = document.getElementById('homepage-frequency-select') as HTMLSelectElement;
    
    if (recurringRadio && recurringRadio.checked && warningDiv && warningAmount && warningFrequency && warningDate) {
      // Get current amount
      const amount = amountInput.value || '50';
      warningAmount.textContent = `$${amount}`;
      
      // Get frequency text
      const frequency = frequencySelect.value;
      const frequencyMap: Record<string, string> = {
        'weekly': 'weekly',
        'biweekly': 'every two weeks',
        'monthly': 'monthly',
        'every6months': 'every six months',
        'yearly': 'yearly'
      };
      warningFrequency.textContent = frequencyMap[frequency] || 'monthly';
      
      // Use today's date
      const today = new Date();
      const dateStr = today.toLocaleDateString('en-US', { 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric' 
      });
      warningDate.textContent = dateStr;
      
      // Show warning
      warningDiv.classList.remove('hidden');
    } else if (warningDiv) {
      // Hide warning for one-time donations
      warningDiv.classList.add('hidden');
    }
  }

  // Function to toggle frequency selection
  function toggleHomepageFrequencySelection() {
    const recurringRadio = document.querySelector('input[name="donationType"][value="recurring"]') as HTMLInputElement;
    const frequencyDiv = document.getElementById('homepage-frequency-selection');
    
    if (frequencyDiv) {
      if (recurringRadio && recurringRadio.checked) {
        frequencyDiv.classList.remove('hidden');
      } else {
        frequencyDiv.classList.add('hidden');
      }
    }
  }

  // Donation type radio buttons
  document.querySelectorAll('input[name="donationType"]').forEach(radio => {
    radio.addEventListener('change', () => {
      toggleHomepageFrequencySelection();
      updateHomepageRecurringWarning();
    });
  });

  // Frequency selection change
  const homepageFrequencySelect = document.getElementById('homepage-frequency-select');
  if (homepageFrequencySelect) {
    homepageFrequencySelect.addEventListener('change', updateHomepageRecurringWarning);
  }

  // Amount button selection
  document.querySelectorAll('.homepage-amount-btn').forEach(btn => {
    btn.addEventListener('click', function() {
      // Remove selected class from all buttons
      document.querySelectorAll('.homepage-amount-btn').forEach(b => b.classList.remove('selected'));
      // Add selected class to clicked button
      this.classList.add('selected');
      // Set the amount in the input
      const customAmountInput = document.getElementById('homepage-custom-amount') as HTMLInputElement;
      if (customAmountInput && this instanceof HTMLElement && this.dataset.amount) {
        customAmountInput.value = this.dataset.amount;
      }
      // Update warning if recurring is selected
      updateHomepageRecurringWarning();
    });
  });

  // Custom amount input
  const homepageCustomAmountInput = document.getElementById('homepage-custom-amount');
  if (homepageCustomAmountInput) {
    homepageCustomAmountInput.addEventListener('input', function() {
      // Remove selected class from preset buttons when typing custom amount
      document.querySelectorAll('.homepage-amount-btn').forEach(b => b.classList.remove('selected'));
      // Update warning if recurring is selected
      updateHomepageRecurringWarning();
    });
  }

  // Form submission
  const homepageDonationForm = document.getElementById('homepage-donation-form') as HTMLFormElement;
  if (homepageDonationForm) {
    homepageDonationForm.addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const btn = document.getElementById('homepage-donate-btn') as HTMLButtonElement;
      const btnText = document.getElementById('homepage-btn-text');
      const btnLoading = document.getElementById('homepage-btn-loading');
      
      if (!btn || !btnText || !btnLoading) return;
      
      // Get form data
      const formData = new FormData(this);
      const amountValue = formData.get('amount');
      const emailValue = formData.get('email');
      const donationTypeValue = formData.get('donationType');
      const frequencyValue = formData.get('frequency');
      
      // Type-safe conversions
      const amount = parseFloat(amountValue?.toString() || '0');
      const email = emailValue?.toString() || '';
      const donationType = donationTypeValue?.toString() || '';
      const frequency = frequencyValue?.toString() || 'monthly';
      
      // Validate amount
      if (!amount || amount < 5) {
        alert('Please enter a donation amount of at least $5');
        return;
      }
      
      if (amount > 999999) {
        alert('Donation amount cannot exceed $999,999');
        return;
      }
      
      // Validate email
      if (!email || !email.includes('@')) {
        alert('Please enter a valid email address');
        return;
      }
      
      // Show loading state
      btn.disabled = true;
      btnText.classList.add('hidden');
      btnLoading.classList.remove('hidden');
      
      try {
        // Call the donation API
        const response = await fetch('https://api.locc.us/api/v2/donation', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            amount: amount,
            email: email,
            donationType: donationType,
            frequency: frequency
          })
        });
        
        const data = await response.json();
        
        if (data.success && data.url) {
          // Redirect to Stripe checkout
          window.location.href = data.url;
        } else {
          throw new Error(data.message || 'Failed to create donation session');
        }
        
      } catch (error) {
        console.error('Donation error:', error);
        alert('There was an error processing your donation. Please try again or contact us for assistance.');
        
        // Reset button state
        btn.disabled = false;
        btnText.classList.remove('hidden');
        btnLoading.classList.add('hidden');
      }
    });
  }

  // Set default amount for homepage form
  const homepageDefaultBtn = document.querySelector('.homepage-amount-btn[data-amount="50"]') as HTMLElement;
  if (homepageDefaultBtn) {
    homepageDefaultBtn.click();
  }
</script>

<style>
  * {
    font-family: 'Albert Sans', system-ui, sans-serif;
  }
  
  h1, h2, h3, h4, h5, h6 {
    font-family: 'Albert Sans', system-ui, sans-serif;
  }

  /* Smooth scrolling for the entire page */
  html {
    scroll-behavior: smooth;
  }

  /* Ensure sections are properly centered when navigated to */
  section[id] {
    scroll-margin-top: 2rem;
  }

  /* For mobile devices, add more top margin */
  @media (max-width: 768px) {
    section[id] {
      scroll-margin-top: 1rem;
    }
  }

  .homepage-amount-btn.selected {
    border-color: #8B5A2B;
    background-color: rgba(139, 90, 43, 0.05);
  }

  .tooltip {
    z-index: 50;
    transform: translateX(-50%);
    left: 50%;
  }

  .tooltip::after {
    content: '';
    position: absolute;
    top: 100%;
    left: 50%;
    margin-left: -5px;
    border-width: 5px;
    border-style: solid;
    border-color: #1f2937 transparent transparent transparent;
  }
</style>
</Layout>
