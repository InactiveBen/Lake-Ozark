---
interface Props {
  message: string;
  title?: string;
  dismissText?: string;
  messageId?: string;
  expiresAt?: string;
  externalLink?: string;
}

const { 
  message, 
  title = 'Important Notice', 
  dismissText = 'Dismiss', 
  messageId, 
  expiresAt,
  externalLink
} = Astro.props;

const uniqueId = messageId || Math.random().toString(36).substring(2, 15);
const isExpired = expiresAt ? new Date() > new Date(expiresAt) : false;
---

{!isExpired && (
  <div 
    id={`alertModal-${uniqueId}`}
    class="fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-6" 
    role="alertdialog" 
    aria-modal="true"
    style="font-family: 'Albert Sans', system-ui, sans-serif;"
  >
    <div class="bg-white rounded-lg max-w-sm w-full p-6 animate-in">
      <h2 class="text-lg font-semibold text-gray-900 mb-3">{title}</h2>
      <p class="text-sm text-gray-600 leading-relaxed mb-6">{message}</p>
      
      {externalLink ? (
        <a
          href={externalLink}
          target="_blank"
          rel="noopener noreferrer"
          id={`externalLink-${uniqueId}`}
          class="block w-full bg-black hover:bg-gray-800 text-white text-sm font-medium py-2.5 rounded-lg transition-colors text-center"
        >
          {dismissText}
        </a>
      ) : (
        <button
          id={`closeAlert-${uniqueId}`}
          class="w-full bg-black hover:bg-gray-800 text-white text-sm font-medium py-2.5 rounded-lg transition-colors"
        >
          {dismissText}
        </button>
      )}
    </div>
  </div>
)}

<style>
  .animate-in {
    animation: fadeIn 0.2s ease-out;
  }
  
  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }
</style>

<script define:vars={{ uniqueId, messageId, expiresAt }}>
  const modal = document.getElementById(`alertModal-${uniqueId}`);
  const closeBtn = document.getElementById(`closeAlert-${uniqueId}`);
  const extLink = document.getElementById(`externalLink-${uniqueId}`);
  
  function close() {
    if (messageId) sessionStorage.setItem(`alert-${messageId}`, 'dismissed');
    modal?.remove();
  }

  if (messageId && (sessionStorage.getItem(`alert-${messageId}`) === 'dismissed' || (expiresAt && new Date() > new Date(expiresAt)))) {
    modal?.remove();
  }

  closeBtn?.addEventListener('click', close);
  extLink?.addEventListener('click', close);
  modal?.addEventListener('click', (e) => { if (e.target === modal) close(); });
  document.addEventListener('keydown', (e) => { if (e.key === 'Escape') close(); });
</script>
