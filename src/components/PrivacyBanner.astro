---
// 
// File: PrivacyBanner.astro
// Component: PrivacyBanner
//
// Description:
// Renders a persistent, mobile-optimized privacy disclosure banner.
// Utilizes client-side JavaScript for state management (cookie persistence)
// and adheres to high standards of accessibility (ARIA).
//
// Usage:
// Import the component and place it near the end of your main layout file.
// Example: <PrivacyBanner />
//
// Dependencies:
// This component assumes the utility classes used (e.g., 'bg-white', 'fixed', 'text-sm')
// are available globally (e.g., via Tailwind CSS integration in your Astro project).
//
---

<div 
  role="dialog"
  id="privacy-banner" 
  class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 shadow-lg px-4 py-3 z-50"
  aria-label="Cookie Consent Banner"
  aria-describedby="privacy-banner-message"
>
  <button
    id="close-privacy-banner"
    class="absolute top-3 right-4 text-gray-500 hover:text-gray-700 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-gray-400 rounded p-1"
    aria-label="Close this dialog"
  >
    <svg width="20px" height="20px" viewBox="0 0 20 20" role="img" aria-labelledby="close-icon-title">
      <title id="close-icon-title">Close this dialog</title>
      <line role="presentation" x1="2" y1="2" x2="18" y2="18" stroke="currentColor" stroke-width="2" stroke-linecap="round"></line>
      <line role="presentation" x1="2" y1="18" x2="18" y2="2" stroke="currentColor" stroke-width="2" stroke-linecap="round"></line>
    </svg>
  </button>

  <div class="pr-12">
    <span id="privacy-banner-message" class="text-sm text-gray-700 leading-relaxed">
      This website utilizes technologies such as cookies to enable essential site functionality, as well as for analytics, personalization, and targeted advertising. To learn more, view the following link: 
      <a 
        href="https://lakeozark.cc/privacy" 
        target="_blank"
        rel="noopener"
        class="text-blue-600 hover:text-blue-800 underline focus:outline-none focus:ring-2 focus:ring-blue-400 rounded"
        aria-describedby="new-window-notice"
      >
        Privacy Policy
      </a>
    </span>
    <span id="new-window-notice" class="sr-only">Opens in a new window</span>
  </div>
</div>

<script>
  // @group State Management Helpers
  
  /**
   * Sets a first-party cookie with specified name, value, and expiration.
   */
  function setCookie(name, value, days) {
    const expires = new Date();
    expires.setTime(expires.getTime() + (days * 24 * 60 * 60 * 1000));
    document.cookie = `${name}=${value}; expires=${expires.toUTCString()}; path=/; SameSite=Lax`;
  }

  /**
   * Retrieves the value of a named cookie.
   */
  function getCookie(name) {
    const nameEQ = name + "=";
    const ca = document.cookie.split(';');
    for(let i = 0; i < ca.length; i++) {
      let c = ca[i];
      while (c.charAt(0) === ' ') c = c.substring(1, c.length);
      if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
    }
    return null;
  }

  // @group Component Logic

  /**
   * Hides the banner if the dismissal cookie is present.
   */
  function checkBannerStatus() {
    const banner = document.getElementById('privacy-banner');
    if (!banner) return;
    
    const dismissed = getCookie('privacy-banner-dismissed');
    if (dismissed === 'true') {
      banner.style.display = 'none';
    }
  }

  /**
   * Hides the banner and sets a persistent cookie for 365 days.
   */
  function dismissBanner() {
    const banner = document.getElementById('privacy-banner');
    if (banner) {
      banner.style.display = 'none';
      setCookie('privacy-banner-dismissed', 'true', 365); // 1-year persistence
    }
  }

  // @group Initialization
  
  document.addEventListener('DOMContentLoaded', function() {
    checkBannerStatus();
    
    // Attach dismissal handler to the close button
    const closeButton = document.getElementById('close-privacy-banner');
    if (closeButton) {
      closeButton.addEventListener('click', dismissBanner);
    }
  });
</script>

<style>
  /*
   * @group Adaptive Presentation
   * The banner is hidden on desktop (default) to maintain a clean layout.
   */
  #privacy-banner {
    display: none;
  }
  
  /*
   * Banner is activated and styled only on mobile viewports.
   */
  @media (max-width: 768px) {
    #privacy-banner {
      display: block;
      /* Smooth entry for refined UX */
      animation: slideUp 0.3s ease-out;
    }
    
    /* Crucial: Add bottom padding to the body when the banner is visible
     * to prevent content clipping on mobile scroll.
     */
    body:has(#privacy-banner:not([style*="display: none"])) {
      padding-bottom: 100px;
    }
  }
  
  /* @keyframe slideUp */
  @keyframes slideUp {
    from {
      transform: translateY(100%);
      opacity: 0;
    }
    to {
      transform: translateY(0);
      opacity: 1;
    }
  }
</style>